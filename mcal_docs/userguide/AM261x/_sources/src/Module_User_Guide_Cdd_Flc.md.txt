## CDD FLC Module

### Acronyms and Definitions

|Abbreviation/Term|Explanation|
|------|------|
|AUTOSAR|Automotive Open System Architecture|
|RTE|Runtime Environment|
|BSW|Basic Software|
|MCAL|Micro Controller Abstraction Layer|
|API|Application Programming Interface|
|DET|Default Error Tracer|
|HW |Hardware|
|SW |Software|
|I/O|Input/Output|
|FLC|Fast Local Copy|
|OS|Operating System|

### Introduction

This document describes the functionality and configuration of the Cdd_Flc module.

|Supported AUTOSAR Release|**4.3.1**|
|------|-------------|
|**Supported Configuration Variants**  | **None**|
|**Vendor ID**                         | **CDD_FLC_VENDOR_ID (44)**|
|**Module ID**                         | **CDD_FLC_MODULE_ID (255)**|
|**Supported Platform**                | **AM263Px, AM261x**|

The FLC CDD provides services to configure the Fast Local Copy (FLC) of the SOC.

### Functional Overview

Each R5F core integrates a Fast Local Copy (FLC) engine to accelerate boot up. Reducing
boot time of R5F is essential to achieve 50ms CAN response.

#### Initialization

This module doesn't support any initialization and de-init routines.
Hence there is no requirement to support pre-compile and post build configuration options.

The driver provides only compile time configuration options via Cdd_Flc_Cfg.h.
The user need to edit this file to have different configuration from
the current default configurations. Generation of this configuration
is not provided via configurator as this module doesn't have or require
init time configurations.

#### States

This driver is stateless.

#### Assumptions

None

#### Limitations

None

#### Design Overview

Please refer **SITARA MCU MCAL Architecture Document** and **MCAL: CDD FLC Detailed Design Document** provided as part of CSP.

### Hardware Features

#### Hardware Features supported

* Support up to four flash regions per FLC with 64kB granularity
* Internal DMA engine to copy code from flash to SRAM sequentially for all regions
* Redirect access to flash when the data is not yet available in SRAM
* Redirect access to SRAM when the data is available in SRAM
* Transparent to core after initial configuration of regions
* Pass-through for addresses not in the programmed regions
* The SRAM redirection does not wait till the entire region is mirrored, but is enabled as soon as the content at that address is valid in SRAM
* Option to disable DMA copy and only enable SRAM redirection

### Source Files

Static source C Files are defined below

ðŸ“¦AM261x\
 â”£ ðŸ“‚build\
 â”£ ðŸ“‚mcal\
 â”ƒ â”£ ðŸ“‚**Cdd_Flc**\
 â”ƒ â”ƒ â”£ ðŸ“‚**include**\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ**Cdd_Flc.h** : *Contains the APIâ€™s of the driver to be used by upper layers.*\
 â”ƒ â”ƒ â”£ ðŸ“‚**src**\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ**Cdd_Flc.c** : *Contains the implementation of the API's for the driver.*\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚**am261**\
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œ**Cdd_Flc_Soc.h** : *Contains SOC specific internal data*\
 â”ƒ â”ƒ â”— ðŸ“œMakefile\
 â”ƒ ðŸ“‚mcal_config\
 â”ƒ ðŸ“‚mcal_docs\
 â”ƒ ðŸ“œREADME.txt

Plugin files are defined below in the table.

|Plugin Files|Description|
|------|------|
|Cdd_Flc_Cfg.h|Contains the Precompile switches, Macros.|

### Module Requirements

Please refer **Software Product Specification** document provided as part of CSP.

#### Memory Mapping

| Memory Mapping Sections                 | CDD_FLC_CODE | CDD_FLC_CONST |
|-----------------------------------------|----------------|-----------------|
| CDD_FLC_START_SEC_CONST_UNSPECIFIED   |                | X               |
| CDD_FLC_STOP_SEC_CONST_UNSPECIFIED    |                | X               |
| CDD_FLC_START_SEC_CODE                | X              |                 |
| CDD_FLC_STOP_SEC_CODE                 | X              |                 |

#### Scheduling

Not applicable

#### Error Handling

##### Development Error Reporting

Development errors are reported to the DET using the service Det_ReportError() when enabled. The driver interface contains the MACRO declaration of the error codes to be returned.

###### Error Codes

|Type of Error|Related Error code|Value (Hex)|
|----|-------|-----|
|API service called will null param pointer|CDD_FLC_E_PARAM_POINTER|0x01|
|API service called with illegal HW ID|CDD_FLC_E_ILLEGAL_HW_ID|0x02|
|API service called invalid configuration|CDD_FLC_E_INVALID_CONFIG|0x03|

###### Runtime Error

None

##### DEM Error

None

### Used Resources

#### Interrupt Handling

None

### Integration Description

#### Dependent Modules

##### DET

The FLC module depends on the DET (by default) to report development errors. The DET can be replaced optionally by an equivalent component which is responsible to recognize development errors, if no DET component is available.

#### Multi-core Support

Not Supported

### Configuration

The FLC Driver implementation supports multiple configuration variants
The driver expects **Cdd_Flc_Cfg.h** to be present as input file.

### Examples

#### Overview

The FLC example configures all the region to map source and destination memory, enables the FLC copy and compare the result.

##### External Connections

None

#### Hardware Software Setup and Tools

See example description above

#### Steps to Build and Run Example

1. FLC example application demonstrating the FLC features is in folder <MCAL_ROOT>/examples/Cdd_Flc.
2. This application can be built from the build folder by giving "gmake â€“s cdd_flc_app PLATFORM=am261"
3. Once the build is completed we get a binary file, which is loaded in our controller and executed.

#### Example Logs

```
CDD_FLC_APP: Sample Application - STARTS !!!

 FLC MCAL Version Info
 ---------------------
 Vendor ID           : 44
 Module ID           : 255
 SW Major Version    : 1
 SW Minor Version    : 0
 SW Patch Version    : 0

CDD_FLC_APP: FLC copy for region ID: 0, Loop: 0!!!
CDD_FLC_APP: FLC copy for region ID: 0, Loop: 1!!!
CDD_FLC_APP: FLC copy for region ID: 0, Loop: 2!!!
CDD_FLC_APP: FLC copy for region ID: 0, Loop: 3!!!
CDD_FLC_APP: FLC copy for region ID: 0, Loop: 4!!!
CDD_FLC_APP: FLC copy for region ID: 1, Loop: 0!!!
CDD_FLC_APP: FLC copy for region ID: 1, Loop: 1!!!
CDD_FLC_APP: FLC copy for region ID: 1, Loop: 2!!!
CDD_FLC_APP: FLC copy for region ID: 1, Loop: 3!!!
CDD_FLC_APP: FLC copy for region ID: 1, Loop: 4!!!
CDD_FLC_APP: FLC copy for region ID: 2, Loop: 0!!!
CDD_FLC_APP: FLC copy for region ID: 2, Loop: 1!!!
CDD_FLC_APP: FLC copy for region ID: 2, Loop: 2!!!
CDD_FLC_APP: FLC copy for region ID: 2, Loop: 3!!!
CDD_FLC_APP: FLC copy for region ID: 2, Loop: 4!!!
CDD_FLC_APP: FLC copy for region ID: 3, Loop: 0!!!
CDD_FLC_APP: FLC copy for region ID: 3, Loop: 1!!!
CDD_FLC_APP: FLC copy for region ID: 3, Loop: 2!!!
CDD_FLC_APP: FLC copy for region ID: 3, Loop: 3!!!
CDD_FLC_APP: FLC copy for region ID: 3, Loop: 4!!!

CDD_FLC_APP: Stack Usage: 824 bytes
CDD_FLC_APP: Sample Application - DONE (Passed) !!!
CDD_FLC_APP: All tests have passed
```

#### File Structure

ðŸ“¦AM261x\
 â”£ ðŸ“‚build\
 â”£ ðŸ“‚mcal\
 â”ƒ â”£ ðŸ“‚**examples**\
 â”ƒ â”ƒ â”£ ðŸ“‚**Cdd_Flc**\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚**soc**\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ**CddFlcApp.c** : *Contains test example.*\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ**CddFlcApp.h** : *Contains test private header containing dependent includes and macro.*\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œMakefile\
 â”ƒ â”£ ðŸ“‚**examples_config**\
 â”ƒ â”ƒ â”£ ðŸ“‚**Cdd_Flc_Demo_Cfg**\
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚**soc**\
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚**am261**\
 â”ƒ â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚**r5f0_0**\
 â”ƒ â”ƒ â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚include\
 â”ƒ â”ƒ â”ƒ â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ**Cdd_Flc_Cfg.h** : *Contains the Precompile switches, Macros for FLC.*\
 â”ƒ ðŸ“‚mcal_config\
 â”ƒ ðŸ“‚mcal_docs\
 â”£ ðŸ“œREADME.txt

### FAQ's

None

### References

[Technical Reference Manual](https://www.ti.com/product/AM2612)
